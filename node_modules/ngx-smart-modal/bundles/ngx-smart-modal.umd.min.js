!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports,require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common"],factory):factory((global.ng=global.ng||{},global.ng.ngxSmartModal={}),global.ng.core,global.ng.common)}(this,function(exports,core,common){"use strict";/**
 * @license ngx-smart-modal
 * MIT license
 */
var NgxSmartModalService=function(){function NgxSmartModalService(){this.modalStack=[]}return NgxSmartModalService.prototype.addModal=function(modalInstance,force){if(force){var i=this.modalStack.findIndex(function(o){return o.id===modalInstance.id});i>-1?this.modalStack[i].modal=modalInstance.modal:this.modalStack.push(modalInstance)}else this.modalStack.push(modalInstance)},NgxSmartModalService.prototype.getModal=function(id){return this.modalStack.filter(function(o){return o.id===id})[0].modal},NgxSmartModalService.prototype.get=function(id){return this.getModal(id)},NgxSmartModalService.prototype.open=function(id,force){void 0===force&&(force=!1);var instance=this.modalStack.find(function(o){return o.id===id});if(!instance)throw new Error("Modal not found");instance.modal.open(force)},NgxSmartModalService.prototype.close=function(id){var instance=this.modalStack.find(function(o){return o.id===id});if(!instance)throw new Error("Modal not found");instance.modal.close()},NgxSmartModalService.prototype.toggle=function(id,force){void 0===force&&(force=!1);var instance=this.modalStack.find(function(o){return o.id===id});if(!instance)throw new Error("Modal not found");instance.modal.toggle(force)},NgxSmartModalService.prototype.getModalStack=function(){return this.modalStack},NgxSmartModalService.prototype.getOpenedModals=function(){var modals=[];return this.modalStack.forEach(function(o){o.modal.visible&&modals.push(o)}),modals},NgxSmartModalService.prototype.getHigherIndex=function(){var index=[1041];return this.getModalStack().forEach(function(o){index.push(o.modal.layerPosition)}),Math.max.apply(Math,index)+1},NgxSmartModalService.prototype.getModalStackCount=function(){return this.modalStack.length},NgxSmartModalService.prototype.removeModal=function(id){var i=this.modalStack.findIndex(function(o){return o.id===id});i>-1&&this.modalStack.splice(i,1)},NgxSmartModalService.prototype.setModalData=function(data,id,force){return!!this.modalStack.find(function(o){return o.id===id})&&(this.getModal(id).setData(data,force),!0)},NgxSmartModalService.prototype.getModalData=function(id){return this.getModal(id).getData()},NgxSmartModalService.prototype.resetModalData=function(id){if(this.modalStack.find(function(o){return o.id===id})){var removed=this.getModal(id).getData();return this.getModal(id).removeData(),removed}return!1},NgxSmartModalService.prototype.closeLatestModal=function(){var me=this;clearTimeout(this.debouncer),this.debouncer=setTimeout(function(){var tmp;return me.getOpenedModals().forEach(function(m){m.modal.layerPosition>(tmp?tmp.modal.layerPosition:0)&&(tmp=m)}),!!tmp&&tmp.modal.close()},100)},NgxSmartModalService.decorators=[{type:core.Injectable}],NgxSmartModalService.ctorParameters=function(){return[]},NgxSmartModalService}(),NgxSmartModalComponent=function(){function NgxSmartModalComponent(_renderer,_changeDetectorRef,_ngxSmartModalService){var _this=this;this._renderer=_renderer,this._changeDetectorRef=_changeDetectorRef,this._ngxSmartModalService=_ngxSmartModalService,this.closable=!0,this.escapable=!0,this.dismissable=!0,this.identifier="",this.customClass="nsm-dialog-animation-fade",this.visible=!1,this.backdrop=!0,this.force=!0,this.hideDelay=500,this.autostart=!1,this.visibleChange=new core.EventEmitter,this.onClose=new core.EventEmitter,this.onCloseFinished=new core.EventEmitter,this.onDismiss=new core.EventEmitter,this.onDismissFinished=new core.EventEmitter,this.onAnyCloseEvent=new core.EventEmitter,this.onAnyCloseEventFinished=new core.EventEmitter,this.onOpen=new core.EventEmitter,this.onEscape=new core.EventEmitter,this.onDataAdded=new core.EventEmitter,this.onDataRemoved=new core.EventEmitter,this.layerPosition=1041,this.overlayVisible=!1,this.openedClass=!1,this.escapeKeyboardEvent=function(event){27===event.keyCode&&(_this.onEscape.emit(_this),_this._ngxSmartModalService.closeLatestModal())}}return NgxSmartModalComponent.prototype.ngOnInit=function(){if(!this.identifier||!this.identifier.length)throw new Error("identifier field isnâ€™t set. Please set one before calling <ngx-smart-modal> in a template.");this.layerPosition+=this._ngxSmartModalService.getModalStackCount(),this._ngxSmartModalService.addModal({id:this.identifier,modal:this},this.force),this.autostart&&this._ngxSmartModalService.open(this.identifier)},NgxSmartModalComponent.prototype.ngOnDestroy=function(){this._ngxSmartModalService.removeModal(this.identifier),window.removeEventListener("keyup",this.escapeKeyboardEvent),this._ngxSmartModalService.getModalStack.length||this._renderer.removeClass(document.body,"dialog-open")},NgxSmartModalComponent.prototype.open=function(top){var _this=this;top&&(this.layerPosition=this._ngxSmartModalService.getHigherIndex()),this._renderer.addClass(document.body,"dialog-open"),this.overlayVisible=!0,this.visible=!0,setTimeout(function(){_this.openedClass=!0,_this.target&&_this.targetPlacement(),_this._changeDetectorRef.markForCheck()}),this.onOpen.emit(this),this.escapable&&window.addEventListener("keyup",this.escapeKeyboardEvent)},NgxSmartModalComponent.prototype.close=function(){var me=this;this.openedClass=!1,this.onClose.emit(this),this.onAnyCloseEvent.emit(this),this._ngxSmartModalService.getOpenedModals().length<2&&this._renderer.removeClass(document.body,"dialog-open"),setTimeout(function(){me.visibleChange.emit(me.visible),me.visible=!1,me.overlayVisible=!1,me._changeDetectorRef.markForCheck(),me.onCloseFinished.emit(me),me.onAnyCloseEventFinished.emit(me)},this.hideDelay),window.removeEventListener("keyup",this.escapeKeyboardEvent)},NgxSmartModalComponent.prototype.dismiss=function(e){var me=this;this.dismissable&&e.target.classList.contains("overlay")&&(this.openedClass=!1,this.onDismiss.emit(this),this.onAnyCloseEvent.emit(this),this._ngxSmartModalService.getOpenedModals().length<2&&this._renderer.removeClass(document.body,"dialog-open"),setTimeout(function(){me.visible=!1,me.visibleChange.emit(me.visible),me.overlayVisible=!1,me._changeDetectorRef.markForCheck(),me.onDismissFinished.emit(me),me.onAnyCloseEventFinished.emit(me)},this.hideDelay),window.removeEventListener("keyup",this.escapeKeyboardEvent))},NgxSmartModalComponent.prototype.toggle=function(top){this.visible?this.close():this.open(top)},NgxSmartModalComponent.prototype.addCustomClass=function(className){this.customClass.length?this.customClass+=" "+className:this.customClass=className},NgxSmartModalComponent.prototype.removeCustomClass=function(className){this.customClass=className?this.customClass.replace(className,"").trim():""},NgxSmartModalComponent.prototype.isVisible=function(){return this.visible},NgxSmartModalComponent.prototype.hasData=function(){return void 0!==this._data},NgxSmartModalComponent.prototype.setData=function(data,force){(!this.hasData()||this.hasData()&&force)&&(this._data=data,this.onDataAdded.emit(this._data),this._changeDetectorRef.markForCheck())},NgxSmartModalComponent.prototype.getData=function(){return this._data},NgxSmartModalComponent.prototype.removeData=function(){this._data=void 0,this.onDataRemoved.emit(!0),this._changeDetectorRef.markForCheck()},NgxSmartModalComponent.prototype.targetPlacement=function(){if(this.nsmDialog&&this.nsmContent&&this.nsmOverlay&&this.target){var targetElementRect=document.querySelector(this.target).getBoundingClientRect(),bodyRect=this.nsmOverlay.nativeElement.getBoundingClientRect(),nsmContentRect=this.nsmContent.nativeElement.getBoundingClientRect(),nsmDialogRect=this.nsmDialog.nativeElement.getBoundingClientRect(),marginLeft=parseInt(getComputedStyle(this.nsmContent.nativeElement).marginLeft,10),marginTop=parseInt(getComputedStyle(this.nsmContent.nativeElement).marginTop,10),offsetTop=targetElementRect.top-nsmDialogRect.top-(nsmContentRect.height-targetElementRect.height)/2,offsetLeft=targetElementRect.left-nsmDialogRect.left-(nsmContentRect.width-targetElementRect.width)/2;offsetLeft+nsmDialogRect.left+nsmContentRect.width+2*marginLeft>bodyRect.width?offsetLeft=bodyRect.width-(nsmDialogRect.left+nsmContentRect.width)-2*marginLeft:offsetLeft+nsmDialogRect.left<0&&(offsetLeft=-nsmDialogRect.left),offsetTop+nsmDialogRect.top+nsmContentRect.height+marginTop>bodyRect.height&&(offsetTop=bodyRect.height-(nsmDialogRect.top+nsmContentRect.height)-marginTop),offsetTop<0&&(offsetTop=0),this._renderer.setStyle(this.nsmContent.nativeElement,"top",offsetTop+"px"),this._renderer.setStyle(this.nsmContent.nativeElement,"left",offsetLeft+"px")}},NgxSmartModalComponent.decorators=[{type:core.Component,args:[{selector:"ngx-smart-modal",template:'\n    <div *ngIf="overlayVisible"\n         [style.z-index]="visible ? layerPosition-1 : -1"\n         [ngClass]="{\'transparent\':!backdrop, \'overlay\':true, \'nsm-overlay-open\':openedClass}"\n         (click)="dismiss($event)" #nsmOverlay>\n      <div [style.z-index]="visible ? layerPosition : -1"\n           [ngClass]="[\'nsm-dialog\', customClass, openedClass ? \'nsm-dialog-open\': \'nsm-dialog-close\']" #nsmDialog>\n        <div class="nsm-content" #nsmContent>\n          <div class="nsm-body">\n            <ng-content></ng-content>\n          </div>\n          <button type="button" *ngIf="closable" (click)="close()" aria-label="Close" class="nsm-dialog-btn-close">&times;</button>\n        </div>\n      </div>\n    </div>\n  '}]}],NgxSmartModalComponent.ctorParameters=function(){return[{type:core.Renderer2},{type:core.ChangeDetectorRef},{type:NgxSmartModalService}]},NgxSmartModalComponent.propDecorators={closable:[{type:core.Input}],escapable:[{type:core.Input}],dismissable:[{type:core.Input}],identifier:[{type:core.Input}],customClass:[{type:core.Input}],visible:[{type:core.Input}],backdrop:[{type:core.Input}],force:[{type:core.Input}],hideDelay:[{type:core.Input}],autostart:[{type:core.Input}],target:[{type:core.Input}],visibleChange:[{type:core.Output}],onClose:[{type:core.Output}],onCloseFinished:[{type:core.Output}],onDismiss:[{type:core.Output}],onDismissFinished:[{type:core.Output}],onAnyCloseEvent:[{type:core.Output}],onAnyCloseEventFinished:[{type:core.Output}],onOpen:[{type:core.Output}],onEscape:[{type:core.Output}],onDataAdded:[{type:core.Output}],onDataRemoved:[{type:core.Output}],nsmContent:[{type:core.ViewChild,args:["nsmContent"]}],nsmDialog:[{type:core.ViewChild,args:["nsmDialog"]}],nsmOverlay:[{type:core.ViewChild,args:["nsmOverlay"]}],targetPlacement:[{type:core.HostListener,args:["window:resize"]}]},NgxSmartModalComponent}(),NgxSmartModalModule=function(){function NgxSmartModalModule(){}return NgxSmartModalModule.forRoot=function(){return{ngModule:NgxSmartModalModule,providers:[NgxSmartModalService]}},NgxSmartModalModule.forChild=function(){return{ngModule:NgxSmartModalModule,providers:[NgxSmartModalService]}},NgxSmartModalModule.decorators=[{type:core.NgModule,args:[{declarations:[NgxSmartModalComponent],exports:[NgxSmartModalComponent],imports:[common.CommonModule]}]}],NgxSmartModalModule.ctorParameters=function(){return[]},NgxSmartModalModule}();exports.NgxSmartModalService=NgxSmartModalService,exports.NgxSmartModalComponent=NgxSmartModalComponent,exports.NgxSmartModalModule=NgxSmartModalModule,Object.defineProperty(exports,"__esModule",{value:!0})});